const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Ve7k0Qld.js","./giJZFj6k.js","./entry.t87rEDIE.css","./CtUCgRtK.js"])))=>i.map(i=>d[i]);
import{D,ag as O,u as Q,X as z,c as d,I as g,J as H,W as G,ah as K,ai as Y,_ as J}from"./giJZFj6k.js";import{t as X}from"./CtUCgRtK.js";/**
 * @license lucide-vue-next v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=D("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-vue-next v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=D("bookmark",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]]);/**
 * @license lucide-vue-next v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=D("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),me=t=>new Date(t).toLocaleDateString("fa-IR",{year:"numeric",month:"long",day:"numeric"}),ge=t=>{var r;return((r=t.meta)==null?void 0:r.readingTime)||1},Z=t=>{if(!t)return[];const r=new Set;return t.forEach(a=>{var n;return(n=a.tags)==null?void 0:n.forEach(i=>r.add(i))}),Array.from(r).sort()},ee=t=>t?[...new Set(t.map(r=>{var a;return(a=r.meta)==null?void 0:a.category}).filter(Boolean))].sort():[],te=(t,r,a)=>r?t:t==null?void 0:t.slice(0,a),re=(t,r)=>Math.max(0,((t==null?void 0:t.length)||0)-r),F={newest:(t,r)=>new Date(r.date)-new Date(t.date),oldest:(t,r)=>new Date(t.date)-new Date(r.date),title:(t,r)=>t.title.localeCompare(r.title),popular:(t,r)=>new Date(r.date)-new Date(t.date)},ye=O("blog",()=>{const{$supabase:t}=Q(),{user:r}=z(),a=d(""),n=d("newest"),i=d("grid"),e=d(null),s=d(null),c=d(!1),h=d(4),u=d([]),m=d([]),w=d(!1),$=d(!1),b=d(new Set),k=d(null),E=d(0),x=async()=>{try{if(!r.value){u.value=[];return}if($.value||k.value===r.value.id&&Date.now()-E.value<1500)return;$.value=!0;const{data:o,error:l}=await t.from("bookmarks").select("post_id").eq("user_id",r.value.id);if(l)throw l;u.value=(o||[]).map(v=>v.post_id),k.value=r.value.id,E.value=Date.now()}catch(o){console.error("Failed to fetch server bookmarks:",o),u.value=[]}finally{$.value=!1}},_=async()=>{w.value||(w.value=!0,await x())},I=o=>{var l,v;return typeof o=="string"?o:o&&typeof o=="object"?o.id||o._id||o.slug||((l=o.path)==null?void 0:l.replace(/^\/blog\//,""))||((v=o._path)==null?void 0:v.replace(/^\/blog\//,"")):(console.error("Invalid post or slug provided:",o),"")},B=o=>{const l=I(o);return l?u.value.includes(l):!1},q=async o=>{const l=I(o);if(!l)return;if(!r.value){G().info("برای ذخیره بوکمارک ابتدا وارد حساب شوید");return}if(b.value.has(l))return;b.value.add(l);const v=u.value.includes(l);v?u.value=u.value.filter(f=>f!==l):u.value=[...u.value,l];try{if(v){const{error:f}=await t.from("bookmarks").delete().eq("user_id",r.value.id).eq("post_id",l);if(f)throw f}else{const{error:f}=await t.from("bookmarks").upsert({user_id:r.value.id,post_id:l});if(f)throw f}}catch(f){console.error("Failed to sync bookmark:",f),v?u.value=[...u.value,l]:u.value=u.value.filter(S=>S!==l)}finally{b.value.delete(l)}},C=g(()=>{if(!m.value)return[];const o=a.value.toLowerCase();return m.value.filter(l=>{var N,L,R;const v=!a.value||l.title.toLowerCase().includes(o)||((N=l.description)==null?void 0:N.toLowerCase().includes(o)),f=!e.value||((L=l.tags)==null?void 0:L.includes(e.value)),S=!s.value||((R=l.meta)==null?void 0:R.category)===s.value,j=n.value!=="popular"||B(l);return v&&f&&S&&j})}),M=g(()=>C.value?[...C.value].sort(F[n.value]||F.newest):[]),A=g(()=>Z(m.value)),W=g(()=>ee(m.value)),U=g(()=>te(A.value,c.value,h.value)),P=g(()=>re(A.value,h.value)),V=o=>{m.value=o};return H(()=>r.value,async o=>{if(!o){w.value=!1,u.value=[],k.value=null;return}o.id!==k.value&&(w.value=!1,await _())}),{searchQuery:a,sortOption:n,viewType:i,selectedTag:e,selectedCategory:s,showAllTags:c,maxVisibleTags:h,bookmarkedPosts:u,allPosts:m,filteredPosts:C,sortedFilteredPosts:M,allTags:A,allCategories:W,visibleTags:U,remainingTagsCount:P,initBookmarks:_,setAllPosts:V,isBookmarked:B,toggleBookmark:q,toggleShowAllTags:()=>{c.value=!c.value},setViewType:o=>{i.value=o},toggleTag:o=>{e.value=e.value===o?null:o},toggleCategory:o=>{s.value=s.value===o?null:o}}}),p=(t,r)=>{const a=t._conditions;return a.length>0?`(${a.join(` ${r} `)})`:""},T=t=>{const r=[],a={_conditions:r,where(n,i,e){let s;switch(i.toUpperCase()){case"IN":case"NOT IN":if(Array.isArray(e)){const c=e.map(h=>y(h)).join(", ");s=`"${String(n)}" ${i.toUpperCase()} (${c})`}else throw new TypeError(`Value for ${i} must be an array`);break;case"BETWEEN":case"NOT BETWEEN":if(Array.isArray(e)&&e.length===2)s=`"${String(n)}" ${i.toUpperCase()} ${y(e[0])} AND ${y(e[1])}`;else throw new Error(`Value for ${i} must be an array with two elements`);break;case"IS NULL":case"IS NOT NULL":s=`"${String(n)}" ${i.toUpperCase()}`;break;case"LIKE":case"NOT LIKE":s=`"${String(n)}" ${i.toUpperCase()} ${y(e)}`;break;default:s=`"${String(n)}" ${i} ${y(typeof e=="boolean"?Number(e):e)}`}return r.push(`${s}`),a},andWhere(n){const i=n(T());return r.push(p(i,"AND")),a},orWhere(n){const i=n(T());return r.push(p(i,"OR")),a}};return a},ae=(t,r)=>{const a={conditions:[],selectedFields:[],offset:0,limit:0,orderBy:[],count:{field:"",distinct:!1}},n={__params:a,andWhere(e){const s=e(T());return a.conditions.push(p(s,"AND")),n},orWhere(e){const s=e(T());return a.conditions.push(p(s,"OR")),n},path(e){return n.where("path","=",K(e))},skip(e){return a.offset=e,n},where(e,s,c){return n.andWhere(h=>h.where(String(e),s,c)),n},limit(e){return a.limit=e,n},select(...e){return e.length&&a.selectedFields.push(...e),n},order(e,s){return a.orderBy.push(`"${String(e)}" ${s}`),n},async all(){return r(t,i()).then(e=>e||[])},async first(){return r(t,i({limit:1})).then(e=>e[0]||null)},async count(e="*",s=!1){return r(t,i({count:{field:String(e),distinct:s}})).then(c=>c[0].count)}};function i(e={}){let s="SELECT ";if(e!=null&&e.count)s+=`COUNT(${e.count.distinct?"DISTINCT ":""}${e.count.field}) as count`;else{const h=Array.from(new Set(a.selectedFields));s+=h.length>0?h.map(u=>`"${String(u)}"`).join(", "):"*"}s+=` FROM ${X[String(t)]}`,a.conditions.length>0&&(s+=` WHERE ${a.conditions.join(" AND ")}`),a.orderBy.length>0?s+=` ORDER BY ${a.orderBy.join(", ")}`:s+=" ORDER BY stem ASC";const c=(e==null?void 0:e.limit)||a.limit;return c>0&&(a.offset>0?s+=` LIMIT ${c} OFFSET ${a.offset}`:s+=` LIMIT ${c}`),s}return n};function y(t){return`'${String(t).replace(/'/g,"''")}'`}const we=t=>{var a,n;const r=(n=(a=Y())==null?void 0:a.ssrContext)==null?void 0:n.event;return ae(t,(i,e)=>ne(r,i,e))};async function ne(t,r,a){return oe(r,a)}async function oe(t,r){return await J(()=>import("./Ve7k0Qld.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(n=>n.loadDatabaseAdapter(t)).then(n=>n.all(r))}export{fe as A,he as B,ve as C,ge as c,me as f,we as q,ye as u};
