const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CXYwFdLV.js","./CROkfFJm.js","./entry.BDbvCBXB.css","./CcQFqvco.js"])))=>i.map(i=>d[i]);
import{D as $,af as J,u as K,ac as Y,c as f,I as y,J as z,X,ag as Z,ah as ee,_ as te}from"./CROkfFJm.js";import{t as re}from"./CcQFqvco.js";/**
 * @license lucide-vue-next v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=$("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-vue-next v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=$("bookmark",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]]);/**
 * @license lucide-vue-next v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=$("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),Ce=r=>new Date(r).toLocaleDateString("fa-IR",{year:"numeric",month:"long",day:"numeric"}),Se=r=>{var n;return((n=r.meta)==null?void 0:n.readingTime)||1},ne=r=>{if(!r)return[];const n=new Set;return r.forEach(a=>{var o;return(o=a.tags)==null?void 0:o.forEach(i=>n.add(i))}),Array.from(n).sort()},ae=r=>r?[...new Set(r.map(n=>{var a;return(a=n.meta)==null?void 0:a.category}).filter(Boolean))].sort():[],oe=(r,n,a)=>n?r:r==null?void 0:r.slice(0,a),se=(r,n)=>Math.max(0,((r==null?void 0:r.length)||0)-n),L={newest:(r,n)=>new Date(n.date)-new Date(r.date),oldest:(r,n)=>new Date(r.date)-new Date(n.date),title:(r,n)=>r.title.localeCompare(n.title),popular:(r,n)=>new Date(n.date)-new Date(r.date)},R={comments:"postComments"},$e=J("blog",()=>{const{$supabase:r}=K(),{user:n}=Y(),a=f(""),o=f("newest"),i=f("grid"),t=f(null),s=f(null),u=f(!1),h=f(5),c=f([]),v=f([]),b=f(null),g=f({}),A=async()=>{try{if(!n.value){c.value=[];return}const{data:e,error:l}=await r.from("bookmarks").select("post_id").eq("user_id",n.value.id);if(l)throw l;c.value=(e||[]).map(d=>d.post_id)}catch(e){console.error("Failed to fetch server bookmarks:",e),c.value=[]}},O=async()=>{await A()},x=()=>{{const e=localStorage.getItem(R.comments);e&&(g.value=JSON.parse(e))}},D=()=>{localStorage.setItem(R.comments,JSON.stringify(g.value))},F=(e,l)=>{g.value[e]||(g.value[e]=[]),g.value[e].push({...l,id:Date.now(),date:new Date().toISOString()}),D()},M=(e,l)=>{g.value[e]&&(g.value[e]=g.value[e].filter(d=>d.id!==l),D())},q=e=>g.value[e]||[],U=e=>{b.value=e},E=e=>{var l,d;return typeof e=="string"?e:e&&typeof e=="object"?e.id||e._id||e.slug||((l=e.path)==null?void 0:l.replace(/^\/blog\//,""))||((d=e._path)==null?void 0:d.replace(/^\/blog\//,"")):(console.error("Invalid post or slug provided:",e),"")},_=e=>{const l=E(e);return l?c.value.includes(l):!1},P=async e=>{const l=E(e);if(!l)return;if(!n.value){X().info("برای ذخیره بوکمارک ابتدا وارد حساب شوید");return}const d=c.value.includes(l);d?c.value=c.value.filter(m=>m!==l):c.value=[...c.value,l];try{if(d){const{error:m}=await r.from("bookmarks").delete().eq("user_id",n.value.id).eq("post_id",l);if(m)throw m}else{const{error:m}=await r.from("bookmarks").upsert({user_id:n.value.id,post_id:l});if(m)throw m}}catch(m){console.error("Failed to sync bookmark:",m),d?c.value=[...c.value,l]:c.value=c.value.filter(S=>S!==l)}},T=y(()=>{if(!v.value)return[];const e=a.value.toLowerCase();return v.value.filter(l=>{var N,B,I;const d=!a.value||l.title.toLowerCase().includes(e)||((N=l.description)==null?void 0:N.toLowerCase().includes(e)),m=!t.value||((B=l.tags)==null?void 0:B.includes(t.value)),S=!s.value||((I=l.meta)==null?void 0:I.category)===s.value,H=o.value!=="popular"||_(l);return d&&m&&S&&H})}),W=y(()=>T.value?[...T.value].sort(L[o.value]||L.newest):[]),C=y(()=>ne(v.value)),Q=y(()=>ae(v.value)),V=y(()=>oe(C.value,u.value,h.value)),j=y(()=>se(C.value,h.value)),G=e=>{v.value=e};return z(()=>n.value,async(e,l)=>{e?await A():c.value=[]}),{searchQuery:a,sortOption:o,viewType:i,selectedTag:t,selectedCategory:s,showAllTags:u,maxVisibleTags:h,bookmarkedPosts:c,allPosts:v,isDarkMode:b,comments:g,filteredPosts:T,sortedFilteredPosts:W,allTags:C,allCategories:Q,visibleTags:V,remainingTagsCount:j,initBookmarks:O,initComments:x,addComment:F,deleteComment:M,getPostComments:q,initDarkMode:U,setAllPosts:G,isBookmarked:_,toggleBookmark:P,toggleShowAllTags:()=>{u.value=!u.value},setViewType:e=>{i.value=e},setSearchQuery:e=>{a.value=e},setSortOption:e=>{o.value=e},toggleTag:e=>{t.value=t.value===e?null:e},toggleCategory:e=>{s.value=s.value===e?null:e},resetFilters:()=>{a.value="",t.value=null,s.value=null}}}),p=(r,n)=>{const a=r._conditions;return a.length>0?`(${a.join(` ${n} `)})`:""},k=r=>{const n=[],a={_conditions:n,where(o,i,t){let s;switch(i.toUpperCase()){case"IN":case"NOT IN":if(Array.isArray(t)){const u=t.map(h=>w(h)).join(", ");s=`"${String(o)}" ${i.toUpperCase()} (${u})`}else throw new TypeError(`Value for ${i} must be an array`);break;case"BETWEEN":case"NOT BETWEEN":if(Array.isArray(t)&&t.length===2)s=`"${String(o)}" ${i.toUpperCase()} ${w(t[0])} AND ${w(t[1])}`;else throw new Error(`Value for ${i} must be an array with two elements`);break;case"IS NULL":case"IS NOT NULL":s=`"${String(o)}" ${i.toUpperCase()}`;break;case"LIKE":case"NOT LIKE":s=`"${String(o)}" ${i.toUpperCase()} ${w(t)}`;break;default:s=`"${String(o)}" ${i} ${w(typeof t=="boolean"?Number(t):t)}`}return n.push(`${s}`),a},andWhere(o){const i=o(k());return n.push(p(i,"AND")),a},orWhere(o){const i=o(k());return n.push(p(i,"OR")),a}};return a},le=(r,n)=>{const a={conditions:[],selectedFields:[],offset:0,limit:0,orderBy:[],count:{field:"",distinct:!1}},o={__params:a,andWhere(t){const s=t(k());return a.conditions.push(p(s,"AND")),o},orWhere(t){const s=t(k());return a.conditions.push(p(s,"OR")),o},path(t){return o.where("path","=",Z(t))},skip(t){return a.offset=t,o},where(t,s,u){return o.andWhere(h=>h.where(String(t),s,u)),o},limit(t){return a.limit=t,o},select(...t){return t.length&&a.selectedFields.push(...t),o},order(t,s){return a.orderBy.push(`"${String(t)}" ${s}`),o},async all(){return n(r,i()).then(t=>t||[])},async first(){return n(r,i({limit:1})).then(t=>t[0]||null)},async count(t="*",s=!1){return n(r,i({count:{field:String(t),distinct:s}})).then(u=>u[0].count)}};function i(t={}){let s="SELECT ";if(t!=null&&t.count)s+=`COUNT(${t.count.distinct?"DISTINCT ":""}${t.count.field}) as count`;else{const h=Array.from(new Set(a.selectedFields));s+=h.length>0?h.map(c=>`"${String(c)}"`).join(", "):"*"}s+=` FROM ${re[String(r)]}`,a.conditions.length>0&&(s+=` WHERE ${a.conditions.join(" AND ")}`),a.orderBy.length>0?s+=` ORDER BY ${a.orderBy.join(", ")}`:s+=" ORDER BY stem ASC";const u=(t==null?void 0:t.limit)||a.limit;return u>0&&(a.offset>0?s+=` LIMIT ${u} OFFSET ${a.offset}`:s+=` LIMIT ${u}`),s}return o};function w(r){return`'${String(r).replace(/'/g,"''")}'`}const be=r=>{var a,o;const n=(o=(a=ee())==null?void 0:a.ssrContext)==null?void 0:o.event;return le(r,(i,t)=>ie(n,i,t))};async function ie(r,n,a){return ce(n,a)}async function ce(r,n){return await te(()=>import("./CXYwFdLV.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(o=>o.loadDatabaseAdapter(r)).then(o=>o.all(n))}export{pe as A,ke as B,Te as C,Se as c,Ce as f,be as q,$e as u};
